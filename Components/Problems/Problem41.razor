@namespace Projecteuler.Components.Problems
@page "/problem/41"
@inherits ProblemBase

@{
    base.BuildRenderTree(__builder);
}

@code {
    protected override int Ref => 41;

    protected override string ProblemTitle => "Pandigital Prime";

    protected override string Description => "<p>We shall say that an $n$-digit number is pandigital if it makes use of all the digits $1$ to $n$ exactly once. For example, $2143$ is a $4$-digit pandigital and is also prime.</p>\n<p>What is the largest $n$-digit pandigital prime that exists?</p>";

    protected override string Explanation => "A 9-digit pandigital number has digits summing to 45, making it divisible by 3. Similarly, an 8-digit one sums to 36, also divisible by 3. Thus, the largest pandigital prime must be at most 7 digits (sum 28). We check permutations of {7,6,5,4,3,2,1} in descending order until we find a prime.";

    protected override long Resolve()
    {
        var digits = new int[] { 7, 6, 5, 4, 3, 2, 1 };
        foreach (var p in GetPermutations(digits))
        {
            long n = long.Parse(string.Join("", p));
            if (IsPrime(n)) return n;
        }
        return 0;
    }

    private IEnumerable<int[]> GetPermutations(int[] list)
    {
        if (list.Length == 1) return new List<int[]> { list };
        var result = new List<int[]>();
        for (int i = 0; i < list.Length; i++)
        {
            var remaining = list.Take(i).Concat(list.Skip(i + 1)).ToArray();
            foreach (var p in GetPermutations(remaining))
            {
                result.Add(new int[] { list[i] }.Concat(p).ToArray());
            }
        }
        return result;
    }

    private bool IsPrime(long n)
    {
        if (n < 2) return false;
        if (n % 2 == 0) return n == 2;
        for (long i = 3; i * i <= n; i += 2)
            if (n % i == 0) return false;
        return true;
    }
}


