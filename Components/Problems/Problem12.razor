@namespace Projecteuler.Components.Problems
@using System.Linq
@page "/problem/12"
@inherits ProblemBase

@{
    base.BuildRenderTree(__builder);
}

@code {
    protected override int Ref => 12;

    protected override string ProblemTitle => "Highly Divisible Triangular Number";

    protected override string Description => "The sequence of triangle numbers is generated by adding the natural numbers. So the 7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms would be:\n1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ...\n\nLet us list the factors of the first seven triangle numbers:\n1: 1\n3: 1, 3\n6: 1, 2, 3, 6\n10: 1, 2, 5, 10\n15: 1, 3, 5, 15\n21: 1, 3, 7, 21\n28: 1, 2, 4, 7, 14, 28\n\nWe can see that 28 is the first triangle number to have over five divisors.\n\nWhat is the value of the first triangle number to have over five hundred divisors?";

    protected override string Explanation => "We generate triangle numbers incrementally and count their divisors efficiently using prime factorization. For a number n = p1^a1 * p2^a2 * ... * pk^ak, the number of divisors is (a1+1) * (a2+1) * ... * (ak+1). We use the fact that triangle number T(n) = n*(n+1)/2, so we can count divisors of n and n+1 separately (with adjustment for their GCD).";

    protected override long Resolve()
    {
        int n = 1;
        long triangleNumber = 1;

        while (true)
        {
            int divisorCount = CountDivisors(triangleNumber);
            
            if (divisorCount > 500)
            {
                return triangleNumber;
            }

            n++;
            triangleNumber += n;
        }
    }

    private int CountDivisors(long number)
    {
        int count = 0;
        long sqrt = (long)Math.Sqrt(number);
        
        for (long i = 1; i <= sqrt; i++)
        {
            if (number % i == 0)
            {
                count += (i * i == number) ? 1 : 2;
            }
        }
        
        return count;
    }
}


