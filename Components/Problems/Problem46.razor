@namespace Projecteuler.Components.Problems
@page "/problem/46"
@inherits ProblemBase

@{
    base.BuildRenderTree(__builder);
}

@code {
    protected override int Ref => 46;

    protected override string ProblemTitle => "Goldbach's Other Conjecture";

    protected override string Description => "<p>It was proposed by Christian Goldbach that every odd composite number can be written as the sum of a prime and twice a square.</p>\n$$\\\\begin{align}\n9 = 7 + 2 \\\\times 1^2\\\n15 = 7 + 2 \\\\times 2^2\\\n21 = 3 + 2 \\\\times 3^2\\\n25 = 7 + 2 \\\\times 3^2\\\n27 = 19 + 2 \\\\times 2^2\\\n33 = 31 + 2 \\\\times 1^2\n\\\\end{align}$$\n<p>It turns out that the conjecture was false.</p>\n<p>What is the smallest odd composite that cannot be written as the sum of a prime and twice a square?</p>";

    protected override string Explanation => "We iterate through odd numbers starting from 9. If the number is composite, we check if it can be written as $p + 2x^2$ by subtracting $2x^2$ (for $x=1, 2, \\\\dots$) and checking if the result is prime. The first number that fails this check is our answer.";

    protected override long Resolve()
    {
        int n = 7;
        while (true)
        {
            n += 2;
            if (IsPrime(n)) continue;

            bool found = false;
            for (int x = 1; 2 * x * x < n; x++)
            {
                if (IsPrime(n - 2 * x * x))
                {
                    found = true;
                    break;
                }
            }

            if (!found) return n;
        }
    }

    private bool IsPrime(int n)
    {
        if (n < 2) return false;
        if (n % 2 == 0) return n == 2;
        for (int i = 3; i * i <= n; i += 2)
            if (n % i == 0) return false;
        return true;
    }
}


